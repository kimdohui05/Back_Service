# ⚠️ README FIRST - 프로젝트 시작 전 필독

## 🔴 Claude Code 세션 시작 시 반드시 읽을 것!

새로운 Claude Code 세션을 시작할 때마다 다음 문서들을 **반드시** 읽어주세요:

```
터미널에서 Claude Code 실행 후 첫 번째 명령:

"docs 폴더의 모든 문서를 읽어주세요"
```

### 필수 문서 목록

1. **README-FIRST.md** (이 파일) - 프로젝트 개요 및 최신 변경사항
2. **PROJECT-STRUCTURE.md** - 프로젝트 구조
3. **database-schema.md** - 데이터베이스 스키마
4. **AUTOMATIC-INTEREST-SYSTEM.md** - 일반 계좌 이자 시스템
5. **SAVINGS-SYSTEM-V3.md** - 적금 시스템 (최신 버전)
6. **REQUIREMENTS-HISTORY.md** - 요구사항 변경 이력

---

## 📋 프로젝트 개요

**프로젝트명**: BankService (은행 서비스 백엔드)

**기술 스택**:
- Spring Boot 3.5.7
- MySQL
- Spring Data JDBC
- Gradle

**주요 기능**:
1. 사용자 관리 (회원가입, 로그인)
2. 일반 계좌 (입출금, 송금, 자동 이자)
3. 적금 계좌 (일일 납입, 기간별 이자율, 중도 해지)

---

## 🔄 최신 변경사항 (2026-01-31)

### V4.1 - 계좌번호 중복 방지

**요구사항**:
> "계좌번호 랜덤 생성할 때 계좌번호가 중복 안되게끔 해줘"

**구현 내용**:
- 계좌번호 생성 시 자동으로 중복 체크
- 중복이면 새로운 번호로 재생성
- 일반 계좌(0으로 시작)와 적금 계좌(9로 시작) 모두 적용

---

### V4 - 1개월 적금 옵션 추가

**요구사항**:
> "한 달 적금을 들었을 경우 1.1%로 계산되게끔 수정해줘"

**구현 내용**:

1. **1개월 적금 옵션 추가**:
   - 기간: 30일
   - 이자율: 1.1% (매일)
   - 이자율 감소: 0.1%/일 (11일 안 넣으면 0%)

2. **기간 옵션**:
   - 1개월(30일): 1.1%
   - 6개월(180일): 1.3%
   - 1년(365일): 1.5%

3. **이자율 감소 시스템**:
   - 입금하지 않은 날마다 현재 이자율이 감소
   - 1개월: 0.1%씩 감소
   - 6개월: 0.05%씩 감소
   - 1년: 0.01%씩 감소
   - 최소값: 0% (0% 아래로는 떨어지지 않음)

2. **추가된 필드**:
   - `current_rate`: 현재 적용 중인 이자율 (변동)
   - `rate`: 초기 이자율 (고정, 변경 안 됨)

3. **스케줄러 동작** (매일 자정):
   - 어제 입금한 계좌: 현재 이자율로 이자 적용
   - 어제 입금하지 않은 계좌: 현재 이자율 감소

4. **데이터베이스 마이그레이션**:
```sql
ALTER TABLE savings
ADD COLUMN current_rate DECIMAL(4, 2) NOT NULL DEFAULT 0;
```

**예시**:
```
Day 1: 입금 → 현재 이자율 1.3% (변동 없음)
Day 2: 입금 안 함 → 현재 이자율 1.25% (0.05% 감소)
Day 3: 입금 안 함 → 현재 이자율 1.20% (0.05% 감소)
Day 4: 입금 → 현재 이자율 1.20% (변동 없음, 이자는 1.20%로 적용)
```

---

## 📊 현재 시스템 상태

### 일반 계좌
- ✅ 계좌번호: 0으로 시작 (중복 방지)
- ✅ 자동 이자: 시간당 1% (복리)
- ✅ 입출금, 송금 기능

### 적금 계좌
- ✅ 계좌번호: 9로 시작 (중복 방지)
- ✅ 기간: 1개월(30일) / 6개월(180일) / 1년(365일)
- ✅ 일일 납입액: 10,000 / 30,000 / 50,000 / 100,000원
- ✅ 초기 이자율:
  - 1개월: 1.1%
  - 6개월: 1.3%
  - 1년: 1.5%
- ✅ 이자율 감소:
  - 입금 안 한 날마다 감소
  - 1개월: 0.1%씩 감소
  - 6개월: 0.05%씩 감소
  - 1년: 0.01%씩 감소
  - 최소: 0%
- ✅ 중도 해지: 원금만 반환, 이자 전액 취소
- ✅ 원금 추적: principal 필드

---

## 🗄️ 데이터베이스 마이그레이션 체크리스트

서버 시작 전 반드시 실행:

```sql
-- 1. account 테이블 (일반 계좌)
ALTER TABLE account
ADD COLUMN last_interest_update DATETIME DEFAULT CURRENT_TIMESTAMP;

-- 2. savings 테이블 (적금 계좌)
ALTER TABLE savings
ADD COLUMN last_deposit_date DATE,
ADD COLUMN principal DECIMAL(20, 2) NOT NULL DEFAULT 0,
ADD COLUMN current_rate DECIMAL(4, 2) NOT NULL DEFAULT 0;
```

---

## 📁 주요 파일 구조

```
src/main/java/com/example/bankservice/
├── account/              # 일반 계좌
│   ├── controller/
│   ├── service/
│   ├── repository/
│   └── dto/
├── savings/              # 적금 계좌
│   ├── controller/
│   ├── service/
│   ├── repository/
│   ├── scheduler/        # 이자 적용 & 이자율 감소 스케줄러
│   └── dto/
├── user/                 # 사용자
│   ├── controller/
│   ├── service/
│   ├── repository/
│   └── dto/
└── deposit/              # (레거시) 이자 스케줄러
    └── InterestScheduler.java
```

---

## 🧪 테스트 방법

### 적금 이자율 감소 테스트

1. **1개월/6개월/1년 적금 개설**:
```bash
curl -X POST http://localhost:8080/api/savings/create \
  -H "Content-Type: application/json" \
  -d '{
    "uid":"user-uuid",
    "accPassword":"1234",
    "period":180,
    "dailyDeposit":10000
  }'
```

2. **Day 1 - 입금**:
```bash
curl -X POST http://localhost:8080/api/savings/deposit \
  -H "Content-Type: application/json" \
  -d '{"accNumber":"9xxxxxxxxxxxx","amount":10000}'
# 잔액: 10,000원, 현재 이자율: 1.3%
```

3. **Day 2 자정 - 이자 적용**:
```
잔액: 10,000 + (10,000 × 0.013) = 10,130원
현재 이자율: 1.3% (변동 없음)
```

4. **Day 2 - 입금 안 함**:
```
잔액: 10,130원 (변동 없음)
```

5. **Day 3 자정 - 이자율 감소**:
```
잔액: 10,130원 (이자 적용 안 됨, 어제 입금 안 했으므로)
현재 이자율: 1.3% - 0.05% = 1.25%
```

6. **Day 3 - 입금**:
```bash
curl -X POST http://localhost:8080/api/savings/deposit \
  -H "Content-Type: application/json" \
  -d '{"accNumber":"9xxxxxxxxxxxx","amount":10000}'
# 잔액: 20,130원, 현재 이자율: 1.25%
```

7. **Day 4 자정 - 이자 적용 (감소된 이자율로)**:
```
잔액: 20,130 + (20,130 × 0.0125) = 20,381원
현재 이자율: 1.25% (변동 없음)
```

---

## ⚙️ 스케줄러 테스트 모드

프로덕션: 매일 자정 실행
테스트: 1분마다 실행 (빠른 테스트용)

**테스트 모드 활성화**:

`SavingsInterestScheduler.java`에서:
```java
// 프로덕션 모드 주석 처리
// @Scheduled(cron = "0 0 0 * * *")

// 테스트 모드 활성화 (주석 해제)
@Scheduled(fixedRate = 60000) // 1분마다
```

**테스트 완료 후 반드시 원래대로 복구!**

---

## 🚨 주의사항

1. **일일 이자율이 매우 높습니다**:
   - 1.1%, 1.3%, 1.5%는 일일 이자율
   - 복리 효과로 매우 빠르게 증가
   - 테스트/데모용 설정

2. **입금하지 않으면 이자율이 감소합니다**:
   - 1개월: 11일 안 넣으면 0% (1.1% ÷ 0.1 = 11일)
   - 6개월: 26일 안 넣으면 0% (1.3% ÷ 0.05 = 26일)
   - 1년: 150일 안 넣으면 0% (1.5% ÷ 0.01 = 150일)

3. **중도 해지 시 이자 전액 취소**:
   - 원금만 반환
   - 이자는 모두 사라짐

4. **데이터베이스 마이그레이션 필수**:
   - 서버 시작 전 ALTER TABLE 실행 필수

---

## 📝 요구사항 변경 이력

상세 내역은 `REQUIREMENTS-HISTORY.md` 참고

### V4.1 (2026-01-31) - 계좌번호 중복 방지
- 계좌번호 생성 시 자동 중복 체크
- 중복 시 재생성

### V4 (2026-01-31) - 1개월 적금 옵션 추가
- 1개월(30일) 적금 추가
- 이자율: 1.1% (매일)
- 이자율 감소: 0.1%/일

### V3 (2026-01-31) - 이자율 감소 기능
- 입금하지 않은 날마다 이자율 감소
- 6개월: 0.05%씩, 1년: 0.01%씩 감소
- 최소 0%

### V2 (2026-01-31) - 기간별 이자율 + 중도 해지
- 기간별 차등 이자율 (6개월 1.3%, 1년 1.5%)
- 원금 추적 시스템
- 중도 해지 시 원금만 반환

### V1 (2026-01-31) - 일일 납입 적금 시스템
- 하루에 한 번만 입금
- 일일 납입액 선택 (10,000 / 30,000 / 50,000 / 100,000)
- 매일 자정 이자 적용

---

## 🔧 트러블슈팅

### 문제: 서버 시작 실패
**원인**: 데이터베이스 컬럼 누락
**해결**: ALTER TABLE 실행

### 문제: 이자가 적용 안 됨
**원인**: 어제 입금하지 않았거나 스케줄러 미실행
**해결**: 로그 확인, 입금 여부 확인

### 문제: 이자율이 계속 감소
**원인**: 입금하지 않은 날이 계속됨
**해결**: 매일 입금하거나 감소를 의도한 동작임

---

## 📞 문서 업데이트

새로운 요구사항이 있을 때마다 다음 파일들을 업데이트:

1. **README-FIRST.md** (이 파일) - 최신 변경사항
2. **REQUIREMENTS-HISTORY.md** - 변경 이력
3. **SAVINGS-SYSTEM-V3.md** - 상세 기술 문서

---

## ✅ 시작 체크리스트

- [ ] docs 폴더의 모든 문서 읽음
- [ ] 데이터베이스 마이그레이션 실행
- [ ] 서버 정상 시작 확인
- [ ] 계좌 생성 테스트
- [ ] 적금 입금 테스트
- [ ] 이자 적용 확인
- [ ] 이자율 감소 확인

---

**마지막 업데이트**: 2026-01-31
**버전**: V4.1 (계좌번호 중복 방지)
