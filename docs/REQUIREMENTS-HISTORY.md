# 요구사항 변경 이력

이 문서는 프로젝트의 모든 요구사항 변경 사항을 시간순으로 기록합니다.

---

## 2026-01-31 15:00 - 적금 이자율 감소 기능 (V3)

### 사용자 요청
> "만약 적금계좌에 돈을 안넣은 하루마다 이자가 0.1%씩 줄어들고 0% 아래로는 안 떨어지게
> 6개월은 0.05% 1년은 0.01%씩 떨어지게끔 해줘"

### 구현 내용

1. **이자율 감소 시스템**:
   - 입금하지 않은 날마다 현재 이자율 감소
   - 6개월(180일): 0.05%씩 감소
   - 1년(365일): 0.01%씩 감소
   - 최소값: 0%

2. **데이터베이스 변경**:
```sql
ALTER TABLE savings
ADD COLUMN current_rate DECIMAL(4, 2) NOT NULL DEFAULT 0;
```

3. **추가된 필드**:
   - `Savings.currentRate`: 현재 적용 중인 이자율 (변동)
   - `Savings.rate`: 초기 이자율 (고정)

4. **스케줄러 로직 변경**:
   - `SavingsInterestScheduler.applyInterestToSavings()`:
     - 어제 입금한 계좌: 현재 이자율로 이자 적용
     - 어제 입금하지 않은 계좌: 현재 이자율 감소
   - `findActiveWithoutDepositOnDate()`: 입금하지 않은 계좌 조회 메서드 추가
   - `updateCurrentRate()`: 현재 이자율 업데이트 메서드 추가

5. **수정된 파일**:
   - `Savings.java` - currentRate 필드 추가
   - `SavingsRepository.java` - current_rate 관련 쿼리 추가
   - `SavingsService.java` - 개설 시 currentRate 초기화
   - `SavingsInterestScheduler.java` - 이자율 감소 로직 추가

### 동작 예시

**6개월 적금 (초기 이자율 1.3%)**:
```
Day 1: 입금 10,000원 → 현재 이자율 1.3%
Day 2 자정: 이자 130원 적용 → 잔액 10,130원, 현재 이자율 1.3%
Day 2: 입금 안 함
Day 3 자정: 현재 이자율 1.25% (0.05% 감소)
Day 3: 입금 10,000원 → 잔액 20,130원, 현재 이자율 1.25%
Day 4 자정: 이자 251원 적용 (20,130 × 0.0125) → 잔액 20,381원
```

**1년 적금 (초기 이자율 1.5%)**:
```
Day 1: 입금 10,000원 → 현재 이자율 1.5%
Day 2 자정: 이자 150원 적용 → 잔액 10,150원, 현재 이자율 1.5%
Day 2: 입금 안 함
Day 3 자정: 현재 이자율 1.49% (0.01% 감소)
```

**0% 도달**:
```
6개월: 26일 연속 입금 안 하면 0% (1.3 ÷ 0.05 = 26)
1년: 150일 연속 입금 안 하면 0% (1.5 ÷ 0.01 = 150)
0%에서는 더 이상 감소하지 않음
```

---

## 2026-01-31 14:00 - 기간별 이자율 + 중도 해지 (V2)

### 사용자 요청
> "기간도 한달이 아닌 6개월 1년 이렇게 선택할 수 있게끔 만들어줘
> 6개월이면 이자가 1.3% 1년이면 1.5%로 되게끔 만들어주고
> 중간에 해지하면 해지하기 전까지 들어간 이자는 전부 취소하고
> 적금을 신청하기 전 금액 + 해지하기 전까지 계좌에 추가로 넣은 금액 돌려주기"

### 구현 내용

1. **기간 선택**:
   - 6개월 (180일): 이자율 1.3%
   - 1년 (365일): 이자율 1.5%

2. **원금 추적 시스템**:
```sql
ALTER TABLE savings
ADD COLUMN principal DECIMAL(20, 2) NOT NULL DEFAULT 0;
```
   - `principal`: 이자를 제외한 순수 납입 금액
   - 입금할 때마다 원금 증가
   - 이자 적용 시에는 원금 변경 없음

3. **중도 해지**:
   - 반환 금액 = 원금 (이자 제외)
   - 취소된 이자 = 현재 잔액 - 원금
   - 원금은 100% 보장

4. **수정된 파일**:
   - `Savings.java` - principal 필드 추가
   - `SavingsCreateRequest.java` - 기간 검증 (180, 365)
   - `SavingsService.java`:
     - 기간별 이자율 설정
     - 입금 시 원금 증가
     - 해지 시 원금만 반환
   - `SavingsRepository.java` - principal 관련 메서드
   - `SavingsInterestScheduler.java` - 계좌별 이자율 사용

### 동작 예시

**6개월 적금, 10일간 매일 10,000원 입금 후 해지**:
```
Day 1~10: 매일 10,000원 입금
  - 원금: 100,000원
  - 잔액 (이자 포함): 185,608원
  - 이자: 85,608원

중도 해지:
  - 반환 금액: 100,000원 (원금만)
  - 취소된 이자: 85,608원
```

---

## 2026-01-31 13:00 - 일일 납입 적금 시스템 (V1)

### 사용자 요청
> "적금 시스템은 하루에 일정 금액을 넣었을 때 하루자정이 지나면 현재계좌에 이자를 11% 추가해주는 역할
> 일정 금액은 10000 30000 50000 100000 이렇게 사용자가 골라서 넣을 수 있게끔"

### 구현 내용

1. **일일 납입 시스템**:
   - 일일 납입액: 10,000 / 30,000 / 50,000 / 100,000원 중 선택
   - 하루에 한 번만 입금 가능

2. **자동 이자 적용**:
   - 매일 자정 00:00:00에 스케줄러 실행
   - 어제 입금한 계좌에만 이자 적용
   - 이자율: 11% (매일)

3. **데이터베이스 변경**:
```sql
ALTER TABLE savings
ADD COLUMN last_deposit_date DATE;
```

4. **생성된 파일**:
   - `savings/dto/Savings.java`
   - `savings/dto/SavingsCreateRequest.java`
   - `savings/dto/SavingsDepositRequest.java`
   - `savings/dto/CloseSavingsRequest.java`
   - `savings/repository/SavingsRepository.java`
   - `savings/service/SavingsService.java`
   - `savings/controller/SavingsController.java`
   - `savings/scheduler/SavingsInterestScheduler.java`

### 동작 예시

**일일 납입액 10,000원**:
```
Day 1: 입금 10,000원
Day 2 자정: 이자 1,100원 → 잔액 11,100원
Day 2: 입금 10,000원 → 잔액 21,100원
Day 3 자정: 이자 2,321원 → 잔액 23,421원
```

---

## 2026-01-31 12:00 - 계좌번호 구분 시스템

### 사용자 요청
> "적금 시스템은 적금 계좌번호가 따로 있어야 돼
> 일반 계좌번호는 맨 앞자리를 0으로 시작하게 하고
> 적금 계좌는 9로 시작하게끔"

### 구현 내용

1. **계좌번호 생성 규칙**:
   - 일반 계좌: 0 + 11자리 랜덤 (예: 012345678901)
   - 적금 계좌: 9 + 11자리 랜덤 (예: 987654321098)

2. **수정된 파일**:
   - `AccountRepository.java` - generateAccountNumber() 수정
   - `SavingsRepository.java` - generateSavingsAccountNumber() 추가

---

## 프로젝트 초기 (2026-01-13)

### 초기 구현 내용

1. **사용자 관리**:
   - 회원가입, 로그인
   - User 엔티티

2. **일반 계좌**:
   - 계좌 개설, 입출금, 송금
   - 시간당 1% 자동 이자 (복리)
   - Account 엔티티

3. **데이터베이스**:
   - user 테이블
   - account 테이블
   - savings 테이블 (미구현)

---

## 문서 업데이트 규칙

새로운 요구사항이 추가될 때마다:

1. **이 파일 (REQUIREMENTS-HISTORY.md)**에 변경 이력 추가
   - 날짜, 시간
   - 사용자 요청 (원문 그대로)
   - 구현 내용
   - 동작 예시
   - 수정/추가된 파일 목록

2. **README-FIRST.md** 업데이트
   - 최신 변경사항 섹션 업데이트
   - 버전 번호 증가

3. **기술 문서** 생성/업데이트
   - SAVINGS-SYSTEM-V3.md 등
   - 상세 기술 설명

---

## 2026-01-31 16:00 - 1개월 적금 옵션 추가 (V4)

### 사용자 요청
> "한 달 적금을 들었을 경우 1.1%로 계산되게끔 수정해줘"

### 구현 내용

1. **1개월 적금 옵션 추가**:
   - 기간: 30일
   - 이자율: 1.1% (매일)
   - 이자율 감소량: 0.1%/일

2. **선택 가능한 기간**:
   - 1개월 (30일): 1.1%
   - 6개월 (180일): 1.3%
   - 1년 (365일): 1.5%

3. **이자율 감소 시스템**:
   - 1개월: 0.1%씩 감소 → 11일 연속 입금 안 하면 0%
   - 6개월: 0.05%씩 감소 → 26일 연속 입금 안 하면 0%
   - 1년: 0.01%씩 감소 → 150일 연속 입금 안 하면 0%

4. **수정된 파일**:
   - `SavingsService.java` - PERIOD_1_MONTH, RATE_1_MONTH 추가
   - `SavingsInterestScheduler.java` - RATE_DECREASE_1_MONTH 추가
   - `BankService_시스템_정리.txt` - 1개월 옵션 설명 추가

### 동작 예시

**1개월 적금**:
```
개설 시: 이자율 1.1%
Day 1: 입금 10,000원 → 잔액 10,000원
Day 2 자정: 이자 110원 적용 → 잔액 10,110원
Day 2: 입금 안 함
Day 3 자정: 이자율 1.0%로 감소 (0.1% 감소)
```

---

## 2026-01-31 17:00 - 계좌번호 중복 방지 (V4.1)

### 사용자 요청
> "계좌번호 랜덤 생성할 때 계좌번호가 중복 안되게끔 해줘"

### 구현 내용

1. **중복 방지 로직 추가**:
   - 계좌번호 생성 후 DB에서 중복 체크
   - 중복이면 다시 생성
   - 최대 100회 시도 후 실패 시 에러

2. **수정된 파일**:
   - `AccountRepository.java` - generateAccountNumber() 메서드 수정
   - `SavingsRepository.java` - generateSavingsAccountNumber() 메서드 수정

### 동작 방식

```java
do {
    // 랜덤 계좌번호 생성
    accNumber = generate();

    // 중복 체크
} while (findByAccNumber(accNumber) != null);
```

---

**마지막 업데이트**: 2026-01-31
**현재 버전**: V4.1
